# 開発日報: ローカル管理機能の実装とディレクトリ構成の整理

**日付**: 2025-12-05
**担当**: Antigravity

## 1. 概要
本日は、ローカル環境での記事執筆・管理効率を向上させるための機能実装と、プロジェクトのメンテナンス性を高めるためのディレクトリ構成の整理を行いました。

## 2. 主な実施内容

### 2.1 記事レイアウト修正
- **対象**: `2025-12-04-openai-code-red.md`
- **内容**: Markdownのテーブル構文に誤りがあり、表示崩れが発生していたため修正しました。

### 2.2 ローカル記事管理機能の実装
ローカルプレビュー画面から直接記事のステータス（Draft/Published/Private）を変更できる機能を追加しました。

- **開発サーバー (`scripts/dev/server.js`)**:
    - Expressサーバーを導入し、ステータス更新用のAPI (`POST /api/update-status`) を実装。
    - CORS対応を行い、閲覧サーバーのポート（例: 8000）がAPIサーバー（3000）と異なっていても動作するようにしました。
    - ポート番号を環境変数 `PORT` で指定可能に変更。
- **管理UI (`assets/js/admin.js`)**:
    - `localhost` での閲覧時のみ、画面右下に管理用プルダウンを表示。
    - API接続時に、相対パスと固定ポート（`localhost:3000`）の両方を試行するフォールバックロジックを実装し、柔軟な開発環境に対応しました。
- **Privateステータスの仕様変更**:
    - 従来: HTMLを削除。
    - 変更後: HTMLは生成するが `posts.json`（記事一覧）には含めない。これにより、非公開記事のローカルプレビューが可能になりました。

### 2.3 ディレクトリ構成の整理
散在していたスクリプトを用途別に整理し、見通しを良くしました。

- **`scripts/` 配下の再編**:
    - `build/`: ビルド関連 (`articles.js`)
    - `dev/`: 開発環境関連 (`server.js`)
    - `cli/`: CLIツール (`posts.js`)
    - `maintenance/`: 保守・移行用 (`fix_tags.js`, `migrate-posts-folders.js` 等)
- **`automation/` の整理**:
    - 汎用スクリプトを `scripts/` に移動し、AIパイプライン専用ディレクトリとして純化しました。
- **パス修正**:
    - 全スクリプトの `require` パスやファイル操作パスを新構成に合わせて修正しました。

## 3. 次のアクション
- 新しいディレクトリ構成での運用定着。
- 必要に応じた追加のメンテナンスツールの整備。

### 2.4 エージェント役割定義の改定
プロジェクトの体制強化に伴い、AIエージェントの役割定義 (`.agent/rules`) を見直しました。

- **Tech Lead & PM化**: 指示待ちではなく、技術的な意思決定とプロジェクト管理を主導する役割へ変更。
- **権限の明確化**: 改善提案やバグ修正は事後報告で進める「バランス型」を採用。
- **ドキュメント整備**:
    - `engineering.md` を新規作成し、技術スタックとディレクトリ構造を明文化。
    - `content-creation.md` に編集者としての役割を追記。

### 2.5 Note投稿支援ツールの実装
記事をNoteにクロスポストする際の作業を効率化するため、ローカルプレビュー画面（Live Server等）で動作する支援ツールを実装しました。

- **クライアントサイド完結型**:
    - バックエンドサーバー（Node.js）への依存を排除し、フロントエンド（`fetch`）のみで完結する仕組みを採用。
    - HTMLファイルと同名のMarkdownファイルを自動的にフェッチし、解析します。
- **実装機能**:
    1.  **見出し画像DL**: Frontmatterの画像パス（`src`プロパティ含む）を解析し、ワンクリックでダウンロード。404エラーハンドリングも実装。
    2.  **タイトルコピー**: クリップボードへコピー後、自動的にNote作成画面のタブを開く（またはフォーカス移動）。
    3.  **本文コピー**: Markdown本文をコピーし、AIエディタへの貼り付けを支援。
    4.  **ハッシュタグコピー**: Frontmatterのタグ情報を `#Tag #Tag` 形式で生成してコピー。
- **UI/UX**:
    - 全ボタンの配色をダークグレーで統一し、記事のデザインを阻害しないように配慮。
    - コピー成功時に緑色に点灯し、フィードバックを明確化。
    - Noteのタブへの自動フォーカス移動により、タブ切り替えの手間を削減。
